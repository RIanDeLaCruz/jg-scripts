<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <style>
      @media(max-width: 768px) {
        .wrapper {
          height: 800px;
          width: 100%;
          overflow: scroll;
        }
        .wrapper svg {
          height: 100%;
          width: auto;
        }
      }
      .tooltip:before {
        width: 12px;
        height: 12px;
        position: absolute;
        content: '';
        background-color: #F3FEFC;
        top: -12px;
        left: -12px;
        border-radius: 50%;
      }
      .tooltip {
        position: absolute;
        border-radius: 16px;
        padding: 16px;
        background-color: #F3FEFC;
        color: #3C949A;
      }
      .tooltip-title {
        font-family: 'Rethink Sans', sans-serif;
        font-size: 20px;
        font-weight: 600;
        line-height: 32px;
        text-align: left;
        margin: 0;
      }
      .tooltip ul:not(.nested) {
        font-family: 'Rethink Sans', sans-serif;
        list-style-type: none;
        padding: 0;
        margin: 0;
      }
      .tooltip .nested {
        list-style-type: disc;
        margin: 0;
        padding: 8px 16px;
        max-width: 25ch;
      }
      .tooltip .row {
        min-height: 24px;
        position: relative;
        margin-left: 32px;
        margin-top: 8px;
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
      }
      .tooltip .row:before {
        position: absolute;
        left: -32px;
        content: attr(data-count);
        background: var(--bg);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-family: inherit;
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <div class="tooltips">
      <p class="tooltip-title">Thailand</p>
      <ul class="rows">
        <li class="row" data-count="2" style="--bg: #BA0001">Universal Robina Corp</li>
        <li class="row" data-count="2" style='--bg: #EEAF00'>Cebu Air Inc</li>
      </ul>
    </div>
    <div class="wrapper" id="phGeo">
    </div>
    <script src="insertPHGeo.js"></script>
    <script>
      const config = {
        'luz': {
          name: 'Philippines',
          data: [
            {
              bu: 'RLC',
              count: 197,
              color: '#005FC6',
              text: "Launched Westin Manila Sonata Hotel, Le Pont, Haraya, Sierra Valley Gardens 4, Springdale Batangas, Calamba 2A, and 1 workable facility in Cyberscape Omega"
            },
            {
              bu: 'URC',
              count: 34,
              color: '#BA0001'
            },
            {
              bu: 'CEB',
              count: 12,
              color: '#EEAF00',
              text: 'Restarted flights to Laoag'
            },
            {
              bu: 'JGSOC',
              count: 2,
              color: '#008638'
            },
            {
              bu: 'JG Summit',
              count: 1,
              color: '#1CB0E3'
            },
          ]
        },
        'vis': {
          name: 'Visayas',
          data: [
            {
              bu: 'RLC',
              count: 42,
              color: '#005FC6',
              text: 'Launched NuStar Mall and Mantawi Residences'
            },
            {
              bu: 'URC',
              count: 11,
              color: '#BA0001'
            },
            {
              bu: 'CEB',
              count: 10,
              color: '#EEAF00'
            },
          ]
        },
        'min': {
          name: 'Mindanao',
          data: [
            {
              bu: 'RLC',
              count: 22,
              color: '#005FC6'
            },
            {
              bu: 'URC',
              count: 2,
              color: '#BA0001'
            },
            {
              bu: 'CEB',
              count: 13,
              color: '#EEAF00'
            },
          ]
        },
      }

      function createTooltip(event, code) {
        let data = config[code]
        console.log(data)
        // Create the tooltip element
        const tooltip = document.createElement('div');
        let title = document.createElement('p')
        title.classList.add('tooltip-title')
        title.textContent = data.name
        let rows = document.createElement('ul')
        rows.classList.add('rows')
        for(let segment of data.data) {
          let row = document.createElement('li')
          row.classList.add('row')
          if(segment.text) {
            let str = `${segment.bu}<ul class="nested"><li>${segment.text}</li></ul>`
            row.innerHTML = str
          } else {
            row.textContent = segment.bu
          }
          row.dataset.count = segment.count
          row.setAttribute('style', `--bg: ${segment.color}`)
          rows.appendChild(row)
        }
        tooltip.appendChild(title)
        tooltip.appendChild(rows)
        tooltip.classList.add('tooltip'); // Add a CSS class for styling (optional)

        document.body.appendChild(tooltip);
        console.log(tooltip)

        // Position the tooltip near the clicked path
        const body = document.body;
        const path = event.target; // Get the clicked path element from the event object
        const rect = path.getBoundingClientRect();
        const tooltipdimensions = tooltip.getBoundingClientRect()
        if(window.matchMedia("(max-width: 768px)").matches) {
          const svgBox = document.querySelector('svg').getBoundingClientRect()
          tooltip.style.left = `${window.pageXOffset + 32}px`;
          tooltip.style.top = `${svgBox.top + document.documentElement.scrollTop +
              svgBox.height - tooltipdimensions.height - 16}px`;
        } else {
          tooltip.style.left = `${rect.left + window.pageXOffset + 14}px`;
          tooltip.style.top = `${rect.top + window.pageYOffset + 14}px`;
        }

        // Remove the tooltip on click outside
        document.querySelector('svg').addEventListener('click', removeTooltip);

        function removeTooltip(evt) {
          if(!evt.target.parentNode.classList.contains('dot')) {
            document.body.removeChild(tooltip);
          }
        }
      }
      document.querySelectorAll('.dot').forEach(el => {
        el.addEventListener('click', evt => {
          document.querySelectorAll('.tooltip').forEach(el => {
            document.body.removeChild(el)
          })
          createTooltip(evt, evt.currentTarget.id)
        })
      })
    </script>
  </body>
</html>
